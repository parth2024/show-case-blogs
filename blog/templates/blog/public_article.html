{% extends 'blog/base.html' %}
{% load static %}

{% block title %}{{ article.title }} - The Ambassadors Blog{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50">
    <!-- Article Header -->
    <header class="bg-white border-b border-gray-200">
        <div class="max-w-5xl mx-auto px-4 py-8">
            <!-- Breadcrumb -->
            <nav class="text-sm mb-6">
                <a href="{% url 'blog:blog_home' %}" class="text-primary hover:text-primary-dark">
                    <i class="fas fa-home mr-1"></i>Blog
                </a>
                <span class="text-gray-400 mx-2">/</span>
                <span class="text-gray-600">{{ article.title|truncatechars:50 }}</span>
            </nav>

            <!-- Categories -->
            {% if article.categories.all %}
            <div class="flex flex-wrap gap-2 mb-4">
                {% for category in article.categories.all %}
                <span class="badge badge-primary">{{ category.name }}</span>
                {% endfor %}
            </div>
            {% endif %}

            <!-- Title -->
            <h1 class="text-4xl lg:text-5xl font-heading font-black text-gray-900 mb-6 leading-tight">
                {{ article.title }}
            </h1>

            <!-- Summary -->
            {% if article.summary %}
            <p class="text-xl text-gray-600 mb-6 leading-relaxed">
                {{ article.summary }}
            </p>
            {% endif %}

            <!-- Author & Meta -->
            <div class="flex flex-wrap items-center gap-6 text-sm text-gray-600">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-gradient-to-br from-primary to-secondary rounded-full flex items-center justify-center text-white font-bold text-lg mr-3">
                        {{ article.author.name|first|upper }}
                    </div>
                    <div>
                        <div class="font-semibold text-gray-900">{{ article.author.name }}</div>
                        <div class="text-xs text-gray-500">Author</div>
                    </div>
                </div>
                
                <div class="flex items-center">
                    <i class="fas fa-calendar mr-2 text-gray-400"></i>
                    {{ article.published_at|date:"F d, Y" }}
                </div>

                <div class="flex items-center">
                    <i class="fas fa-clock mr-2 text-gray-400"></i>
                    {{ reading_time }} min read
                </div>

                <div class="flex items-center">
                    <i class="fas fa-eye mr-2 text-gray-400"></i>
                    {{ article.view_count|default:0 }} views
                </div>
            </div>
        </div>
    </header>

    <!-- Article Content -->
    <article class="py-12 px-4">
        <div class="max-w-4xl mx-auto">
            <!-- Showcase Image -->
            {% if article.showcase_image %}
            <div class="mb-12 rounded-2xl overflow-hidden shadow-2xl">
                <img 
                    src="{{ article.showcase_image.link }}" 
                    alt="{{ article.title }}"
                    class="w-full h-auto object-cover"
                >
            </div>
            {% endif %}

            <!-- Article Body -->
            <div class="prose prose-lg max-w-none bg-white rounded-2xl p-8 lg:p-12 shadow-lg mb-12">
                {{ processed_content|safe }}
            </div>

            <!-- Like & Share Section -->
            <div class="bg-white rounded-2xl p-8 shadow-lg mb-12">
                <div class="flex flex-wrap items-center justify-between gap-6">
                    <!-- Like Button -->
                    <form method="post" action="{% url 'blog:like_article' article.id %}" class="flex items-center">
                        {% csrf_token %}
                        <button type="submit" class="btn {% if user_has_liked %}btn-primary{% else %}btn-ghost{% endif %} group">
                            <i class="fas fa-heart mr-2 {% if not user_has_liked %}group-hover:text-red-500{% endif %}"></i>
                            <span class="font-semibold">{{ like_count }}</span>
                            <span class="ml-1">{% if like_count == 1 %}Like{% else %}Likes{% endif %}</span>
                        </button>
                    </form>

                    <!-- Share Buttons -->
                    <div class="flex items-center gap-3">
                        <span class="text-sm font-medium text-gray-600 mr-2">Share:</span>
                        <a href="https://twitter.com/intent/tweet?url={{ request.build_absolute_uri }}&text={{ article.title }}" 
                           target="_blank"
                           class="btn btn-ghost text-blue-400 hover:bg-blue-50">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri }}" 
                           target="_blank"
                           class="btn btn-ghost text-blue-600 hover:bg-blue-50">
                            <i class="fab fa-facebook"></i>
                        </a>
                        <a href="https://www.linkedin.com/shareArticle?mini=true&url={{ request.build_absolute_uri }}&title={{ article.title }}" 
                           target="_blank"
                           class="btn btn-ghost text-blue-700 hover:bg-blue-50">
                            <i class="fab fa-linkedin"></i>
                        </a>
                        <button onclick="copyToClipboard()" class="btn btn-ghost text-gray-600 hover:bg-gray-100">
                            <i class="fas fa-link"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Comments Section -->
            <div class="bg-white rounded-2xl p-8 shadow-lg mb-12">
                <h3 class="text-2xl font-heading font-bold text-gray-900 mb-6">
                    <i class="fas fa-comments mr-2 text-primary"></i>
                    Comments ({{ comments.count }})
                </h3>

                <!-- Comment Form -->
                <form method="post" class="mb-8 p-6 bg-gray-50 rounded-xl">
                    {% csrf_token %}
                    <h4 class="font-semibold text-gray-900 mb-4">Leave a Comment</h4>
                    
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="name" class="block text-sm font-medium text-gray-700 mb-2">Name</label>
                            <input type="text" name="name" id="name" required class="input">
                        </div>
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                            <input type="email" name="email" id="email" required class="input">
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label for="content" class="block text-sm font-medium text-gray-700 mb-2">Comment</label>
                        <textarea name="content" id="content" rows="4" required class="input"></textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-paper-plane mr-2"></i>
                        Post Comment
                    </button>
                </form>

                <!-- Comments List -->
                {% if comments %}
                <div class="space-y-6">
                    {% for comment in comments %}
                    <div class="flex gap-4 p-4 bg-gray-50 rounded-xl">
                        <div class="flex-shrink-0">
                            <div class="w-12 h-12 bg-gradient-to-br from-primary to-secondary rounded-full flex items-center justify-center text-white font-bold">
                                {{ comment.user_name|first|upper }}
                            </div>
                        </div>
                        <div class="flex-1">
                            <div class="flex items-center justify-between mb-2">
                                <h5 class="font-semibold text-gray-900">{{ comment.user_name }}</h5>
                                <span class="text-sm text-gray-500">{{ comment.created_at|date:"M d, Y" }}</span>
                            </div>
                            <p class="text-gray-700">{{ comment.content }}</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-8 text-gray-500">
                    <i class="fas fa-comment-slash text-4xl mb-3 text-gray-300"></i>
                    <p>No comments yet. Be the first to comment!</p>
                </div>
                {% endif %}
            </div>

            <!-- Related Articles -->
            {% if related_articles %}
            <div class="bg-white rounded-2xl p-8 shadow-lg">
                <h3 class="text-2xl font-heading font-bold text-gray-900 mb-6">
                    <i class="fas fa-newspaper mr-2 text-primary"></i>
                    More from {{ article.author.name }}
                </h3>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    {% for related in related_articles %}
                    <article class="group">
                        {% if related.showcase_image %}
                        <div class="aspect-video overflow-hidden bg-gray-200 rounded-lg mb-3">
                            <img 
                                src="{{ related.showcase_image.link }}" 
                                alt="{{ related.title }}"
                                class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"
                            >
                        </div>
                        {% endif %}
                        <h4 class="font-heading font-bold text-gray-900 mb-2 line-clamp-2 group-hover:text-primary transition-colors">
                            {{ related.title }}
                        </h4>
                        <a href="{% url 'blog:public_article' related.slug %}" class="text-sm text-primary hover:text-primary-dark">
                            Read more <i class="fas fa-arrow-right ml-1"></i>
                        </a>
                    </article>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
    </article>

    <!-- Back to Blog -->
    <div class="py-8 px-4 bg-white border-t border-gray-200">
        <div class="max-w-4xl mx-auto text-center">
            <a href="{% url 'blog:blog_home' %}" class="btn btn-primary">
                <i class="fas fa-arrow-left mr-2"></i>
                Back to Blog
            </a>
        </div>
    </div>
</div>

<script>
function copyToClipboard() {
    const url = window.location.href;
    navigator.clipboard.writeText(url).then(() => {
        alert('Link copied to clipboard!');
    });
}
</script>

<style>
/* Prose styling for article content */
.prose {
    color: #374151;
    line-height: 1.8;
}

.prose h2 {
    font-family: 'Bricolage Grotesque', sans-serif;
    font-weight: 700;
    font-size: 2rem;
    margin-top: 2.5em;
    margin-bottom: 1em;
    color: #111827;
}

.prose h3 {
    font-family: 'Bricolage Grotesque', sans-serif;
    font-weight: 600;
    font-size: 1.625rem;
    margin-top: 2em;
    margin-bottom: 0.75em;
    color: #111827;
}

.prose p {
    margin-top: 1.5em;
    margin-bottom: 1.5em;
    font-size: 1.125rem;
}

.prose img {
    margin-top: 2.5em;
    margin-bottom: 2.5em;
    border-radius: 1rem;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
}

.prose strong {
    color: #111827;
    font-weight: 600;
}

.prose a {
    color: #9333ea;
    text-decoration: underline;
    text-underline-offset: 2px;
}

.prose a:hover {
    color: #7c3aed;
}

.prose ul, .prose ol {
    margin-top: 1.5em;
    margin-bottom: 1.5em;
    padding-left: 1.75em;
}

.prose li {
    margin-top: 0.75em;
    margin-bottom: 0.75em;
}

.prose blockquote {
    font-style: italic;
    border-left: 4px solid #9333ea;
    padding-left: 1.5em;
    margin: 2em 0;
    color: #6b7280;
    background: #f9fafb;
    padding: 1.5em;
    border-radius: 0.5rem;
}

.prose code {
    background-color: #f3f4f6;
    padding: 0.25em 0.5em;
    border-radius: 0.375rem;
    font-size: 0.9em;
    font-family: 'Courier New', monospace;
    color: #be185d;
}

.prose pre {
    background-color: #1f2937;
    color: #f3f4f6;
    padding: 1.5em;
    border-radius: 0.75rem;
    overflow-x: auto;
    margin: 2em 0;
}

.prose pre code {
    background-color: transparent;
    padding: 0;
    color: inherit;
}

.line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}
</style>
{% endblock %}